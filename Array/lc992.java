package Array;

import java.util.HashMap;

public class lc992 {
    public int subarraysWithKDistinct(int[] A, int K) {
        int count=0, left1=0,left2=0,right=0,len=A.length,size;
        HashMap<Integer,Integer>map1=new HashMap<>();
        HashMap<Integer,Integer>map2=new HashMap<>();
        while (right<len) {
            addInt(map1, A[right]);
            addInt(map2, A[right]);



            if (map1.size()>K){
                map1=new HashMap<>();
                map1.putAll(map2);
                left1=left2;
                while (map1.size()>K){
                    removeInt(map1, A[left1]);
                    removeInt(map2, A[left2]);
                    left1++;
                    left2++;
                }
            }
            if (map1.size()==K){

                while (removeInt(map2, A[left2])==K){
                    left2++;
                }
                count+=(left2-left1+1);
                addInt(map2,A[left2]);
            }

            right++;
        }
        return count;
    }

    public int addInt(HashMap<Integer,Integer>map,int num){
        if (map.containsKey(num)){
            map.replace(num, map.get(num)+1);
        }
        else map.put(num, 1);
        return map.size();
    }

    public int removeInt(HashMap<Integer,Integer>map,int num){
        if (map.get(num)==1)map.remove(num);
        else {
            map.replace(num, map.get(num)-1);
        }
        return map.size();
    }

    /**
     * 计算小于等于K的子数组数量 在计算小于等于K-1的 两者作差
     * @param A
     * @param K
     * @return
     */
    public int subarraysWithKDistinct2(int[] A, int K) {
        return subarrayWithLessKDistinct(A, K)-subarrayWithLessKDistinct(A, K-1);
    }

    public int subarrayWithLessKDistinct(int[] A, int K){
        int len=A.length,left=0,right=0,count=0,res=0;
        int[] numMap=new int[len+1];
        while (right<len){
            if (numMap[A[right]]==0){
                count++;
            }
            numMap[A[right]]++;

            if (count>K){
                while (count>K){
                    numMap[A[left]]--;
                    if (numMap[A[left]]==0){
                        count--;
                    }
                    left++;
                }
            }
            right++;
            res+=(right-left);
        }
        return res;
    }

    public static void main(String[] args) {
        lc992 obj=new lc992();
        int[] A=new int[]{
                9920,
        15021,
                474,
                5218,
                1390,
                3869,
                5025,
                12074,
                3404,
                14219,
                7666,
                9535,
                1975,
                14171,
                4983,
                5058,
                4153,
                1227,
                9739,
                1216,
                4175,
                6824,
                18233,
                14085,
                12073,
                8474,
                8844,
                12641,
                13405,
                8461,
                6662,
                13084,
                5494,
                1694,
                17632,
                12454,
                2735,
                1268,
                19306,
                3373,
                10241,
                14201,
                8858,
                9696,
                1940,
                16897,
                328,
                91,
                4199,
                17594,
                15444,
                9200,
                7972,
                2267,
                1681,
                13600,
                14911,
                10186,
                16287,
                12231,
                5003,
                18623,
                17886,
                5334,
                11236,
                9942,
                4107,
                19166,
                4187,
                1603,
                5362,
                1296,
                6254,
                1599,
                10698,
                13126,
                13664,
                7878,
                19935,
                7994,
                14457,
                4489,
                19794,
                7587,
                16634,
                943,
                6089,
                12421,
                4382,
                2820,
                4679,
                11372,
                5856,
                15380,
                7840,
                13047,
                17670,
                18166,
                11952,
                17068,
                11152,
                13447,
                9633,
                15940,
                8693,
                1850,
                15795,
                17587,
                8192,
                952,
                3345,
                6311,
                10228,
                3517,
                3563,
                16073,
                1455,
                19303,
                16675,
                15599,
                14725,
                12730,
                13642,
                11115,
                7399,
                4000,
                505,
                16700,
                18369,
                9925,
                16351,
                19323,
                1627,
                7751,
                2535,
                2056,
                19100,
                12063,
                11501,
                13530,
                3798,
                4866,
                14987,
                180,
                1429,
                3318,
                16524,
                16331,
                14017,
                6896,
                12875,
                909,
                4068,
                314,
                17910,
                11416,
                12309,
                4913,
                1850,
                11233,
                4635,
                11190,
                6790,
                1186,
                9705,
                13882,
                18078,
                19350,
                14563,
                11533,
                3650,
                16199,
                8442,
                14944,
                5368,
                9332,
                14644,
                16708,
                5959,
                11028,
                8465,
                1319,
                19203,
                3909,
                12148,
                13234,
                12931,
                6798,
                14808,
                9161,
                3624,
                796,
                9029,
                801,
                2100,
                2818,
                14018,
                19920,
                13430,
                14201,
                18748,
                11432,
                10553,
                7180,
                839,
                11180,
                993,
                855,
                5382,
                13785,
                17075,
                8462,
                6749,
                7229,
                16920,
                15136,
                4326,
                11262,
                15584,
                15206,
                19315,
                11547,
                10505,
                280,
                2333,
                19004,
                11592,
                11662,
                5944,
                4071,
                18152,
                5265,
                10937,
                3690,
                2730,
                14833,
                6395,
                12717,
                7656,
                15899,
                2979,
                13461,
                2715,
                13656,
                733,
                7834,
                12085,
                683,
                14066,
                5624,
                19424,
                7653,
                201,
                19970,
                4233,
                18252,
                1266,
                15861,
                9866,
                6289,
                16454,
                18317,
                8013,
                17474,
                1995,
                12926,
                18294,
                1522,
                13696,
                11134,
                15766,
                19154,
                2106,
                175,
                14016,
                15412,
                88,
                8541,
                5118,
                3534,
                16821,
                9714,
                8869,
                6231,
                14327,
                13304,
                12025,
                14188,
                10582,
                10681,
                11816,
                1340,
                4641,
                11993,
                17179,
                16065,
                5720,
                1753,
                5115,
                6238,
                442,
                4246,
                12492,
                9897,
                13155,
                18468,
                12789,
                782,
                1120,
                17136,
                16640,
                945,
                977,
                18854,
                6165,
                13258,
                13497,
                8908,
                4050,
                1319,
                17924,
                2578,
                13557,
                674,
                7514,
                7081,
                12990,
                3053,
                8700,
                16250,
                7045,
                5726,
                1009,
                12535,
                9304,
                17143,
                8012,
                5158,
                9716,
                16947,
                7206,
                8023,
                19788,
                11282,
                11975,
                16125,
                11724,
                16048,
                3204,
                17558,
                15559,
                19853,
                6440,
                8834,
                6985,
                5897,
                16255,
                4423,
                19230,
                9165,
                18918,
                15145,
                336,
                992,
                18232,
                13410,
                16543,
                18537,
                807,
                7752,
                13061,
                10508,
                11275,
                10995,
                5570,
                8712,
                19909,
                9553,
                4924,
                13024,
                17746,
                17419,
                15687,
                8512,
                3313,
                2255,
                4670,
                16549,
                15557,
                2269,
                14217,
                6227,
                76,
                19950,
                13514,
                5366,
                12613,
                17529,
                691,
                13995,
                14422,
                9507,
                3672,
                9199,
                18753,
                3723,
                647,
                5603,
                4304,
                16333,
                19147,
                8901,
                12136,
                5170,
                13735,
                9668,
                12783,
                18327,
                12141,
                8477,
                19083,
                4422,
                6847,
                3057,
                8981,
                14097,
                12040,
                15934,
                7139,
                11939,
                6368,
                15191,
                859,
                2523,
                7005,
                10444,
                18137,
                528,
                9203,
                14204,
                3576,
                11466,
                18669,
                14115,
                2233,
                5871,
                19625,
                7689,
                17775,
                1686,
                2939,
                3741,
                2158,
                728,
                14335,
                5118,
                17945,
                15468,
                15154,
                5717,
                2111,
                13441,
                13887,
                14934,
                15486,
                19774,
                12008,
                15504,
                3981,
                15913,
                18156,
                19983,
                7506,
                5519,
                932,
                18773,
                15451,
                11977,
                8719,
                9421,
                15531,
                17701,
                15040,
                12427,
                17120,
                18886,
                14320,
                14283,
                7440,
                10539,
                8480,
                4422,
                7669,
                3228,
                13495,
                7043,
                3264,
                1720,
                14662,
                9845,
                11843,
                7353,
                7634,
                1016,
                12604,
                8838,
                1512,
                199,
                11711,
                1164,
                934,
                1797,
                13407,
                6807,
                10642,
                15193,
                11338,
                10266,
                11780,
                7238,
                16506,
                13832,
                11949,
                12956,
                7750,
                1970,
                14411,
                13252,
                5185,
                12018,
                13796,
                5522,
                4734,
                17283,
                6362,
                19732,
                5553,
                9269,
                15588,
                16099,
                13254,
                923,
                11563,
                7807,
                708,
                597,
                11788,
                16724,
                244,
                16721,
                11847,
                16134,
                13999,
                6811,
                9979,
                2141,
                14514,
                2119,
                660,
                3680,
                774,
                14845,
                3098,
                5158,
                2313,
                14697,
                8935,
                15552,
                4351,
                13581,
                17147,
                7984,
                17806,
                10154,
                3439,
                16114,
                9768,
                17907,
                11834,
                12654,
                13636,
                7921,
                12954,
                4069,
                9897,
                12064,
                8567,
                15621,
                17405,
                2671,
                7021,
                14978,
                10825,
                18352,
                6138,
                15707,
                15832,
                9820,
                13347,
                17209,
                17356,
                103,
                4478,
                6645,
                11834,
                17,
                11498,
                3801,
                13617,
                891,
                7199,
                19879,
                4336,
                18162,
                9636,
                9658,
                3863,
                13370,
                7434,
                2050,
                4704,
                17218,
                13872,
                5004,
                10475,
                10768,
                13997,
                11892,
                16538,
                4898,
                1835,
                4389,
                16210,
                13116,
                3601,
                13284,
                16075,
                2439,
                11440,
                8585,
                5966,
                19055,
                15856,
                10138,
                7284,
                4291,
                4061,
                10405,
                1578,
                15988,
                9684,
                2502,
                6898,
                12001,
                16243,
                12153,
                13638,
                3130,
                18561,
                13907,
                2402,
                16143,
                4387,
                19170,
                3580,
                7754,
                16985,
                4234,
                10296,
                12450,
                3810,
                7452,
                12775,
                5751,
                12927,
                7822,
                19885,
                8854,
                19451,
                6285,
                4213,
                8414,
                6951,
                1142,
                9863,
                11219,
                2508,
                3450,
                18651,
                2419,
                15062,
                17775,
                2449,
                16544,
                9040,
                9062,
                4457,
                11056,
                10001,
                558,
                8083,
                3967,
                5388,
                12268,
                15228,
                16222,
                15697,
                4608,
                19933,
                13069,
                15559,
                18430,
                8729,
                5959,
                909,
                11427,
                1848,
                5616,
                1630,
                19386,
                14200,
                11723,
                16175,
                5274,
                5116,
                4618,
                12976,
                12719,
                5392,
                3595,
                2753,
                15177,
                9120,
                3426,
                8010,
                12431,
                9922,
                13490,
                6542,
                8988,
                14823,
                18699,
                18214,
                3998,
                7867,
                19305,
                19917,
                13839,
                16796,
                19005,
                13334,
                15336,
                3112,
                2701,
                2043,
                16938,
                17644,
                8376,
                19441,
                2316,
                1781,
                5092,
                3446,
                7628,
                19983,
                2693,
                19686,
                3373,
                9529,
                11972,
                8116,
                8118,
                19359,
                795,
                18648,
                12500,
                15405,
                17248,
                4061,
                7372,
                3887,
                550,
                12200,
                265,
                2510,
                8794,
                13879,
                16860,
                2552,
                17819,
                13528,
                1966,
                10130,
                3582,
                2161,
                19552,
                12997,
                18098,
                4840,
                3430,
                19836,
                5176,
                6487,
                11188,
                17007,
                4597,
                7272,
                11679,
                4467,
                13129,
                8127,
                1218,
                5158,
                3880,
                12424,
                3282,
                7469,
                18619,
                11296,
                15470,
                16594,
                11968,
                6528,
                1113,
                2448,
                16470,
                9897,
                5583,
                7240,
                12909,
                15121,
                15804,
                6343,
                19794,
                19179,
                7812,
                4673,
                2056,
                6160,
                15433,
                6892,
                11732,
                5947,
                1913,
                14387,
                2987,
                18377,
                14976,
                549,
                12449,
                11002,
                496,
                17407,
                11060,
                10731,
                8029,
                893,
                4104,
                14165,
                18151,
                5301,
                11056,
                14273,
                1227,
                10850,
                15271,
                2264,
                18831,
                7259,
                17304,
                9569,
                16897,
                10606,
                5489,
                1817,
                1157,
                11763,
                19995,
                6844,
                15812,
                5618,
                8209,
                5695,
                11811,
                19883,
                11087,
                19974,
                4182,
                17082,
                5820,
                16660,
                3974,
                16167,
                5097,
                11673,
                13418,
                15641,
                1445,
                14816,
                8553,
                19680,
                3943,
                11362,
                13991,
                5179,
                18518,
                9235,
                12482,
                5480,
                8630,
                14943,
                5230,
                10120,
                2385,
                10076,
                457,
                12862,
                1856,
                4133,
                11741,
                15974,
                3903,
                8402,
                8715,
                11430,
                3871,
                6745,
                356,
                6927,
                4424,
                19875,
                16053,
                9877,
                55,
                18542,
                15067,
                15643,
                19104,
                7463,
       7,
                5839,
                1208,
                13436,
                19820,
                4129,
                12080,
                12706,
                2654,
                720,
                15029,
                6104,
                2392,
                3395,
                12557,
                936,
                13718,
                5846,
                17647,
                7873};
        int K=3;
        System.out.println(obj.subarraysWithKDistinct(A, K));
    }
}
